<!DOCTYPE html>
<html lang="zh-CN">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ç³»ç»Ÿé…ç½® - AI æ¯’èˆŒç§€</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        :root {
            --primary-gradient: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            --glass-bg: rgba(255, 255, 255, 0.9);
            --glass-border: 1px solid rgba(255, 255, 255, 0.3);
            --shadow: 0 8px 32px 0 rgba(31, 38, 135, 0.15);
            --accent-color: #764ba2;
            --danger-color: #e53e3e;
            --success-color: #48bb78;
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Inter', -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, sans-serif;
            background: linear-gradient(-45deg, #ee7752, #e73c7e, #23a6d5, #23d5ab);
            background-size: 400% 400%;
            animation: gradient 15s ease infinite;
            min-height: 100vh;
            padding: 20px;
            color: #2d3748;
        }

        @keyframes gradient {
            0% {
                background-position: 0% 50%;
            }

            50% {
                background-position: 100% 50%;
            }

            100% {
                background-position: 0% 50%;
            }
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
        }

        /* Header */
        .header {
            display: flex;
            align-items: center;
            justify-content: space-between;
            margin-bottom: 40px;
            padding: 20px;
            background: rgba(255, 255, 255, 0.1);
            backdrop-filter: blur(10px);
            border-radius: 16px;
            border: var(--glass-border);
        }

        .header h1 {
            color: white;
            font-size: 2em;
            margin: 0;
            text-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
        }

        .header-actions {
            display: flex;
            gap: 10px;
        }

        .btn {
            padding: 8px 16px;
            border-radius: 20px;
            border: none;
            cursor: pointer;
            font-weight: 600;
            transition: all 0.3s;
            display: inline-flex;
            align-items: center;
            gap: 6px;
            text-decoration: none;
        }

        .btn-primary {
            background: white;
            color: var(--accent-color);
        }

        .btn-primary:hover {
            background: #f7fafc;
            transform: translateY(-2px);
        }

        .btn-danger {
            background: rgba(229, 62, 62, 0.8);
            color: white;
        }

        .btn-danger:hover {
            background: #c53030;
        }

        .btn-success {
            background: var(--success-color);
            color: white;
        }

        .btn-success:hover {
            background: #38a169;
        }

        /* Glass Card Generic */
        .glass-card {
            background: var(--glass-bg);
            backdrop-filter: blur(10px);
            border-radius: 24px;
            border: var(--glass-border);
            box-shadow: var(--shadow);
            padding: 30px;
            margin-bottom: 30px;
        }

        h2 {
            color: #2d3748;
            font-size: 1.5em;
            margin-bottom: 20px;
            display: flex;
            align-items: center;
            justify-content: space-between;
        }

        /* Model Mapping Grid */
        .grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 20px;
        }

        .config-card {
            background: white;
            border-radius: 16px;
            padding: 20px;
            border: 1px solid #e2e8f0;
            transition: transform 0.2s;
            position: relative;
            overflow: hidden;
            display: flex;
            flex-direction: column;
            height: 100%;
        }

        .config-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 10px 20px rgba(0, 0, 0, 0.05);
        }

        .card-header {
            display: flex;
            align-items: center;
            gap: 12px;
            margin-bottom: 15px;
            padding-bottom: 15px;
            border-bottom: 1px solid #f0f0f0;
        }

        .avatar {
            width: 40px;
            height: 40px;
            background: #f7fafc;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 20px;
        }

        .judge-name {
            font-weight: 700;
            font-size: 1.1em;
            color: #2d3748;
        }

        .judge-id {
            font-size: 0.8em;
            color: #718096;
            margin-left: auto;
            font-family: monospace;
        }

        .persona-preview {
            font-size: 0.9em;
            color: #4a5568;
            background: #f7fafc;
            padding: 10px;
            border-radius: 8px;
            margin-bottom: 15px;
            max-height: 100px;
            overflow-y: auto;
            white-space: pre-wrap;
            flex-grow: 1;
        }

        .card-actions {
            display: flex;
            justify-content: flex-end;
            gap: 10px;
            margin-top: auto;
        }

        .btn-sm {
            padding: 4px 10px;
            font-size: 0.85em;
            border-radius: 12px;
        }

        /* Modal */
        .modal-overlay {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0, 0, 0, 0.5);
            display: flex;
            align-items: center;
            justify-content: center;
            z-index: 1000;
            opacity: 0;
            pointer-events: none;
            transition: opacity 0.3s;
        }

        .modal-overlay.active {
            opacity: 1;
            pointer-events: all;
        }

        .modal {
            background: white;
            width: 90%;
            max-width: 600px;
            border-radius: 16px;
            padding: 30px;
            box-shadow: 0 20px 50px rgba(0, 0, 0, 0.2);
            transform: translateY(20px);
            transition: transform 0.3s;
        }

        .modal-overlay.active .modal {
            transform: translateY(0);
        }

        .form-group {
            margin-bottom: 20px;
        }

        .form-label {
            display: block;
            margin-bottom: 8px;
            font-weight: 600;
            color: #4a5568;
        }

        .form-input,
        .form-textarea,
        .form-select {
            width: 100%;
            padding: 10px;
            border: 1px solid #e2e8f0;
            border-radius: 8px;
            font-family: inherit;
            font-size: 1em;
        }

        .form-textarea {
            height: 150px;
            resize: vertical;
        }

        .form-hint {
            font-size: 0.8em;
            color: #718096;
            margin-top: 5px;
        }

        .modal-footer {
            display: flex;
            justify-content: flex-end;
            gap: 10px;
            margin-top: 30px;
        }

        /* Toast */
        .toast {
            position: fixed;
            bottom: 30px;
            right: 30px;
            background: #2d3748;
            color: white;
            padding: 12px 24px;
            border-radius: 8px;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.15);
            transform: translateY(100px);
            transition: transform 0.3s;
            z-index: 2000;
        }

        .toast.active {
            transform: translateY(0);
        }

        .loading {
            text-align: center;
            padding: 40px;
            color: #718096;
        }
    </style>
</head>

<body>
    <div class="container">
        <div class="header">
            <h1><i class="fas fa-sliders-h"></i> ç³»ç»Ÿé…ç½®ä¸­å¿ƒ</h1>
            <div class="header-actions">
                <button onclick="resetConfig()" class="btn btn-danger"><i class="fas fa-undo"></i> é‡ç½®ä¸ºé»˜è®¤</button>
                <a href="/" class="btn btn-primary"><i class="fas fa-home"></i> è¿”å›é¦–é¡µ</a>
            </div>
        </div>

        <div id="loading" class="glass-card loading">
            <i class="fas fa-sync fa-spin fa-2x"></i><br><br>è¯»å–é…ç½®ä¸­...
        </div>

        <div id="content" style="display:none;">
            <div class="glass-card">
                <h2>
                    <span><i class="fas fa-robot"></i> è¯„å§”æ¨¡å‹ç®¡ç†</span>
                    <button onclick="openAddModal()" class="btn btn-success btn-sm"><i class="fas fa-plus"></i>
                        æ·»åŠ è¯„å§”</button>
                </h2>
                <div id="judgeGrid" class="grid"></div>
            </div>

            <div class="glass-card">
                <h2><i class="fas fa-info-circle"></i> é…ç½®è¯´æ˜</h2>
                <div style="color: #4a5568; line-height: 1.6;">
                    <p>åœ¨æ­¤é¡µé¢æ‚¨å¯ä»¥è‡ªç”±é…ç½® AI è¯„å§”çš„äººè®¾ã€‚é…ç½®ä¼šè‡ªåŠ¨ä¿å­˜åˆ° <code>app/judge_config.json</code> æ–‡ä»¶ä¸­ã€‚</p>
                    <ul style="margin-left: 20px; margin-top: 10px;">
                        <li><strong>ID</strong>: è¯„å§”çš„å”¯ä¸€æ ‡è¯†ç¬¦ (å¦‚ <code>my_new_judge</code>)ã€‚</li>
                        <li><strong>æ˜¾ç¤ºåç§°</strong>: å‰ç«¯æ˜¾ç¤ºçš„è¯„å§”åå­—ã€‚</li>
                        <li><strong>äººè®¾ (Persona)</strong>: å®šä¹‰è¯„å§”æ€§æ ¼ã€è¯´è¯é£æ ¼å’Œåè§çš„æ ¸å¿ƒ Promptã€‚</li>
                    </ul>
                </div>
            </div>
        </div>
    </div>

    <!-- Edit/Add Modal -->
    <div id="modalOverlay" class="modal-overlay">
        <div class="modal">
            <h2 id="modalTitle">ç¼–è¾‘è¯„å§”</h2>
            <div class="form-group">
                <label class="form-label">è¯„å§” ID (Key)</label>
                <input type="text" id="judgeId" class="form-input" placeholder="ä¾‹å¦‚: new_judge">
                <div class="form-hint">å”¯ä¸€æ ‡è¯†ç¬¦ï¼Œåªèƒ½åŒ…å«å­—æ¯ã€æ•°å­—å’Œä¸‹åˆ’çº¿ã€‚</div>
            </div>
            <div class="form-group">
                <label class="form-label">æ˜¾ç¤ºåç§°</label>
                <input type="text" id="displayName" class="form-input" placeholder="ä¾‹å¦‚: æ¯’èˆŒè¯„å§”">
            </div>
            <div class="form-group">
                <label class="form-label">äººè®¾å®šä¹‰ (Persona)</label>
                <textarea id="personaText" class="form-textarea" placeholder="ã€äººè®¾å®šä¹‰ï¼š...ã€‘"></textarea>
                <div class="form-hint">æ”¯æŒ Markdown æ ¼å¼ã€‚è¯·åŒ…å«æ ¸å¿ƒæ€§æ ¼ã€è¯­è¨€é£æ ¼ã€åè§å’Œå£å¤´ç¦…ã€‚</div>
            </div>
            <div class="modal-footer">
                <button onclick="closeModal()" class="btn" style="background:#edf2f7">å–æ¶ˆ</button>
                <button onclick="saveJudge()" class="btn btn-success">ä¿å­˜</button>
            </div>
        </div>
    </div>

    <div id="toast" class="toast">æ“ä½œæˆåŠŸ</div>

    <script>
        let currentConfig = {};
        let editingId = null;

        const AVATARS = {
            'chatgpt5_judge': 'ğŸ¤–',
            'grok_judge': 'ğŸš€',
            'gemini_judge': 'ğŸ§ ',
            'doubao_judge': 'ğŸ¥Ÿ',
            'qwen_judge': 'ğŸ“œ',
            'default': 'ğŸ‘¾'
        };

        window.addEventListener('DOMContentLoaded', loadConfig);

        async function loadConfig() {
            try {
                const res = await fetch('/api/config/judges');
                if (!res.ok) throw new Error('Failed to load config');
                currentConfig = await res.json();
                renderGrid();
                document.getElementById('loading').style.display = 'none';
                document.getElementById('content').style.display = 'block';
            } catch (err) {
                alert('åŠ è½½é…ç½®å¤±è´¥: ' + err.message);
            }
        }

        function renderGrid() {
            const container = document.getElementById('judgeGrid');
            container.innerHTML = Object.entries(currentConfig).map(([id, info]) => `
                <div class="config-card">
                    <div class="card-header">
                        <div class="avatar">${AVATARS[id] || AVATARS['default']}</div>
                        <div class="judge-name">${info.display_name}</div>
                        <div class="judge-id">${id}</div>
                    </div>
                    <div class="persona-preview">${info.persona}</div>
                    <div class="card-actions">
                        <button onclick="editJudge('${id}')" class="btn btn-primary btn-sm"><i class="fas fa-edit"></i> ç¼–è¾‘</button>
                        <button onclick="deleteJudge('${id}')" class="btn btn-danger btn-sm"><i class="fas fa-trash"></i> åˆ é™¤</button>
                    </div>
                </div>
            `).join('');
        }

        function openAddModal() {
            editingId = null;
            document.getElementById('modalTitle').innerText = 'æ·»åŠ æ–°è¯„å§”';
            document.getElementById('judgeId').value = '';
            document.getElementById('judgeId').disabled = false;
            document.getElementById('displayName').value = '';
            document.getElementById('personaText').value = '';
            document.getElementById('modalOverlay').classList.add('active');
        }

        function editJudge(id) {
            editingId = id;
            const info = currentConfig[id];
            document.getElementById('modalTitle').innerText = 'ç¼–è¾‘è¯„å§”';
            document.getElementById('judgeId').value = id;
            document.getElementById('judgeId').disabled = true;
            document.getElementById('displayName').value = info.display_name;
            document.getElementById('personaText').value = info.persona;
            document.getElementById('modalOverlay').classList.add('active');
        }

        function closeModal() {
            document.getElementById('modalOverlay').classList.remove('active');
        }

        async function saveJudge() {
            const id = document.getElementById('judgeId').value.trim();
            const displayName = document.getElementById('displayName').value.trim();
            const persona = document.getElementById('personaText').value.trim();

            if (!id || !displayName || !persona) {
                alert('è¯·å¡«å†™æ‰€æœ‰å­—æ®µ');
                return;
            }

            // Update local state
            if (editingId) {
                // Edit mode
                currentConfig[editingId] = { ...currentConfig[editingId], display_name: displayName, persona: persona };
            } else {
                // Add mode
                if (currentConfig[id]) {
                    alert('è¯„å§” ID å·²å­˜åœ¨');
                    return;
                }
                currentConfig[id] = { display_name: displayName, persona: persona };
            }

            await syncConfig();
            closeModal();
        }

        async function deleteJudge(id) {
            if (!confirm(`ç¡®å®šè¦åˆ é™¤è¯„å§” "${currentConfig[id].display_name}" å—ï¼Ÿ`)) return;
            delete currentConfig[id];
            await syncConfig();
        }

        async function resetConfig() {
            if (!confirm('ç¡®å®šè¦é‡ç½®æ‰€æœ‰é…ç½®ä¸ºé»˜è®¤å€¼å—ï¼Ÿæ­¤æ“ä½œä¸å¯æ’¤é”€ã€‚')) return;
            try {
                const res = await fetch('/api/config/judges/reset', { method: 'POST' });
                if (!res.ok) throw new Error('Reset failed');
                const data = await res.json();
                currentConfig = data.config;
                renderGrid();
                showToast('é…ç½®å·²é‡ç½®');
            } catch (err) {
                alert('é‡ç½®å¤±è´¥: ' + err.message);
            }
        }

        async function syncConfig() {
            try {
                const res = await fetch('/api/config/judges', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify(currentConfig)
                });
                if (!res.ok) throw new Error('Save failed');
                renderGrid();
                showToast('é…ç½®å·²ä¿å­˜');
            } catch (err) {
                alert('ä¿å­˜å¤±è´¥: ' + err.message);
            }
        }

        function showToast(msg) {
            const toast = document.getElementById('toast');
            toast.innerText = msg;
            toast.classList.add('active');
            setTimeout(() => toast.classList.remove('active'), 3000);
        }
    </script>
</body>

</html>